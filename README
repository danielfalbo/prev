

        __ ____  ___  __   ____  ____    ___  __ ____  ____    ___
        `M6MMMMb `MM 6MM  6MMMMb `MM(    )M'  `M6MMMMb `MM(    )M'
         MM'  `Mb MM69 " 6M'  `Mb `Mb    d'    MM'  `Mb `Mb    d'
         MM    MM MM'    MM    MM  YM.  ,P     MM    MM  YM.  ,P
         MM    MM MM     MMMMMMMM   MM  M      MM    MM   MM  M
         MM    MM MM     MM         `Mbd'      MM    MM   `Mbd'
         MM.  ,M9 MM     YM    d9    YMP   68b MM.  ,M9    YMP
         MMYMMM9 _MM_     YMMMM9      M    Y89 MMYMMM9      M
         MM                                    MM          d'
         MM                                    MM      (8),P
        _MM_                                  _MM_      YMM

                  Build your website like it's 1996,
            deploy on Vercel (if you want) like it's 2026.


BLUF

  - Vanilla anti-framework that scales down.
  - Compiles instanly. Pages also load instantly.
  - Personal website with bookmarks, blog and RSS.
  - Implements SSG in Python reading data from a SQLite.

  hn: https://news.ycombinator.com/item?id=46229756

WELCOME

  This repo contains all code and data for my personal website, blog, bookmarks.

  Visit https://danielfalbo.com to see it in action.

  In case you are reading this document somewhere else, you can find the
  official git repository at https://github.com/danielfalbo/prev.py.

USE AS TEMPLATE

  You can fork and use this as a template for your website.

  You can deploy this for free on https://vercel.com in a couple of clicks,
  or it's obviously also ready to be deployed anywhere and everywhere else.

STATIC SITE GENERATION

  Your computer likely already comes with python3 installed.

  Run

    python3 prev.py

  and you will be able to

    open dist/index.html

  or any generated html file under 'dist/' with your browser.

  It can be ergonomic to

    cd dist/
    python3 -m http.server

  and then browse to http://localhost:8000 so that absolute hrefs will work too,
  among other features that may be broken when just opening the generated html
  files from the filesystem with the browser.

DATABASE SCHEMA

  Your computer likely already comes with sqlite3 installed.

  You can see the database schema by running the

    sqlite3 knowledge.db '.schema'

  command.

  The schema roughly looks like:

    authors(id, slug, name, created_time);
    bookmarks(id, slug, title, created_time, html);
    bookmark_authors(bookmark_id, author_id);
    weblog(id, slug, title, created_time, html, listed).

  You can clear the data and start from scratch by running

    sqlite3 knowledge.db '.schema' > create.sql
    rm knowledge.db
    sqlite3 knowledge.db < create.sql

  effectively making a "create.sql" script out of the current db schema,
  deleting the database, and recreating it from scratch.

HTML, CSS, JS, TEMPLATES, COMPONENTS, LAYOUTS AND PAGES

  There are no external HTML template files. The structure of the website is
  defined entirely in 'prev.py' using Python functions. Some CSS and JS is
  occasionally injected by Python as well.

  To make changes to the site, edit the "=== HTML Templates and Components ==="
  section of 'prev.py'.

  For all entries of tables that have a 'created_time' property, there is a
  special component

    <span id='dateage'></span>

  you can use in the entry 'html' content to display the dynamic age of a post.
  The inner text of the component will be replaced with a string like

    'written on December 15, 2022 (2y ago, 19.01 y.o.)'

  via injected js based on the 'created_time' value of the given entry in the
  database and the 'AUTHOR_BIRTHDAY' from 'prev.py' as ISO 8601 date string.

RSS FEEDS

  The site generator automatically creates an RSS 2.0 XML feed for tables
  defined at 'RSS_TABLES' in 'prev.py'. These are output to 'dist/<table>/rss'.

  The content within the RSS items includes the raw HTML from the database
  entry wrapped in CDATA tags.

CREATING/UPDATING/DELETING DATA

  The database is a git-tracked file. The generated website is static and
  read-only. There is no server listening for requests to operate on the db.
  All data editing is done offline by running queries onto the 'knowledge.db'
  SQLite database file.

  Note: git-tracking the database will break if you'll make changes to the DB
    on multiple branches and then try to merge them. Changes to the DB are
    expected to always be made on a single branch and no db merges are ever
    expected. We're all consenting adults here.

  To create or edit a page you can use the ergonomic helper script:

    ./edit.sh <table> <slug>

  which, if the entry does not exist, will prompt you for the necessary
  metadata (Title or Name) and create the record for you. It will then open
  the HTML content in vi and dump it back to database on exit.

  The edit.sh script creates a local temp 'buf_<table>_<slug>.html' file.
  1. If the buffer file is not empty when you start (e.g., after a crash), the
     script will ask if you want to resume editing that file to prevent data
     loss, or overwrite it with DB content.
  2. The buffer file is only cleared/emptied after the content is successfully
    committed to the database.

  For ergonomic editing and previewing of the html content, prev.py also comes
  with a live compilation feature.

  You can start live compiling 'dist/<table>/[slug].html' with local
  'buf_<table>_<slug>.html' content on save by starting the watch server with

    python3 prev.py --watch <table> <slug>

  or by using the edit.sh with the '--watch' flag as

    ./edit.sh --watch <table> <slug>

  which will run the watcher in the background and terminate it on exit.

  Note: the watcher only works on BSD because it relies on the 'kqueue' syscall
    to listen for file changes.

DB DIFF

  Since the database is a binary file, standard 'git diff' is not useful to
  inspect pending changes. You can tell git to ask 'sqlite3' for a text dump of
  the database when computing diffs by running

    git config diff.sqlite3.textconv "sh -c 'sqlite3 \$0 .dump'"

  and then 'git diff' will work as usual with '.db' files too.

  Note: we tell git that the filetype for '*.db' files is 'sqlite3' in the
    '.gitattributes' file.

LLMs ASSISTANCE

  To easily share the codebase with an LLM for assistance, you can run

    ./ai.sh

  which concatenates relevant source files and copies them to the clipboard.

  Note: requires 'pbcopy' and works only on macOS.

  Note: included source files are hardcoded in the 'ai.sh' script.

PRINCIPLES

  > "Simple things should be simple, complex things should be possible."
    - Alan Kay

  > "Make every detail perfect and limit the number of details to perfect."
    - Jack Dorsey

  > "Good design is as little design as possible."
    - Dieter Rams

TODO, MAYBE

  - Drop 'RELATIONSHIPS' in favour of native SQLite views.

  - Introduce SNIPPETS(id, slug, txt, created_time, author_id).

  - Notion/Substack content parity:
    https://cdn.danielfalbo.com/tags.png,
    https://cdn.danielfalbo.com/routine.png,
    https://cdn.danielfalbo.com/old.png,

  - Introduce a server and dynamic content to implement visitors stats and text
    message user reach-out form, make sure client-facing SQL queries are
    injection-safe, if any. Minimize JSON parsing overhead: consider returing
    HTML from the server. Handle post submission without reload: listen for
    'submit' event.

  - Consider https://html3000.dev,
    https://news.ycombinator.com/item?id=44937991,
    http://bettermotherfuckingwebsite.com,
    https://danburzo.ro/add-a-web-feed/

  - Improve overall accessibility: it should be as accessible and bulletproof
    as critical services websites should.
    https://news.ycombinator.com/item?id=26691156

  - More granular sqlite diff. Substring level.
